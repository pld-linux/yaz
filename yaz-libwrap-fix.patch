--- yaz-2.0.21/configure.in.orig	2004-05-14 10:19:16.000000000 +0200
+++ yaz-2.0.21/configure.in	2004-05-16 00:10:45.787417432 +0200
@@ -209,6 +209,7 @@
 dnl
 dnl ------ tcpd
 AC_ARG_ENABLE(tcpd,[  --enable-tcpd[=PREFIX]  enable TCP wrapper for server if available])
+WRAPLIBS=""
 if test "$enable_tcpd" != "" && test "$enable_tcpd" != "no"; then
 	oldLibs=$LIBS
 	oldCPPFLAGS=$CPPFLAGS
@@ -217,7 +218,7 @@
 		CPPFLAGS="$CPPFLAGS -I$enable_tcpd/include"
 	fi
 	AC_MSG_CHECKING(for working tcpd.h)
-	LIBS="$LIBS -lwrap -lnsl"
+	LIBS="$LIBS -lwrap"
 	AC_TRY_LINK([#include <syslog.h>
 #include <tcpd.h>
 	int allow_severity = LOG_INFO;
@@ -227,13 +228,15 @@
 	tcpd_ok=1, tcpd_ok=0)
 	if test "$tcpd_ok" = "0"; then
 		AC_MSG_RESULT(no)
-		LIBS=$oldLibs
 		CPPFLAGS=$oldCPPFLAGS
 	else
 		AC_MSG_RESULT(yes)
 		AC_DEFINE(HAVE_TCPD_H)
+		WRAPLIBS="-lwrap"
 	fi
+	LIBS=$oldLibs
 fi
+AC_SUBST(WRAPLIBS)
 dnl
 dnl ------ Headers
 AC_CHECK_HEADERS(fnmatch.h wchar.h locale.h langinfo.h)
--- yaz-2.0.6/src/Makefile.am.orig	2003-10-27 13:21:30.000000000 +0100
+++ yaz-2.0.6/src/Makefile.am	2003-12-07 11:14:22.779872136 +0100
@@ -64,6 +64,7 @@
   eventl.c seshigh.c statserv.c requestq.c tcpdchk.c \
   eventl.h service.c service.h session.h
 libyaz_la_LDFLAGS=-version-info $(YAZ_VERSION_INFO)
+libyaz_la_LIBADD=$(WRAPLIBS)
 
 libyazthread_la_SOURCES=
 libyazthread_la_LIBADD=thr-nmem.lo thr-statserv.lo thr-eventl.lo
